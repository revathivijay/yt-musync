<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="" />
    <meta name="author" content="" />
    <link rel="icon" href="../../favicon.ico" />

    <title>Youtube Mu-sync</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link
      href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css"
      rel="stylesheet"
    />

    <!-- Custom styles for this template -->
    <link href="css/main.css" rel="stylesheet" />
  </head>

  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button
            type="button"
            class="navbar-toggle collapsed"
            data-toggle="collapse"
            data-target="#navbar"
            aria-expanded="false"
            aria-controls="navbar"
          >
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">YT Mu-sync</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav font-size">
            <li><a href="home">Home</a></li>
            <li><a href="video">Enter Video URL</a></li>
            <li><a href="contact">Contact Us</a></li>
          </ul>
        </div>
        <!--/.nav-collapse -->
      </div>
    </nav>
    <div class="container">
      <div id="ytplayer">
        <script>
          setInterval(progressBarLoop, 100);
          function progressBarLoop() {
            var progressBar = $('#progress-bar');
            var progressCircle = $('#circle');
            
            progressBar.click(function(event){
              var offset = $(this).offset();
              var x = event.pageX - offset.left;
              var y = event.pageY - offset.top;
              var width = $(this).width();
              var height = $(this).height();
              var percent = x / width;
              var time = percent * player.getDuration();
              player.seekTo(time);
              console.log("Seeked ahead to: " + time);
              var converted = player.getCurrentTime() / player.getDuration() * 100;
              console.log("Fraction: " + converted);
              progressCircle.css('margin-left', converted + '%');
            });
          }
        </script>
        <script>
          // Load the IFrame Player API code asynchronously.
          var tag = document.createElement("script");
          tag.src = "https://www.youtube.com/player_api";
          var firstScriptTag = document.getElementsByTagName("script")[0];
          firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

          var player;
          function onYouTubePlayerAPIReady() {
            player = new YT.Player("ytplayer", {
              height: "720",
              width: "1080",
              videoId: "DGGCUPHodd4",
              events: {
                onReady: onPlayerReady,
                onStateChange: onPlayerStateChange,
              },
              playerVars: {
                controls: 0,
                // disablekb: 1,
                modestbranding: 1,
                rel: 0,
                showinfo: 0,
                iv_load_policy: 3,
              },
            });
          }
          function onPlayerReady(event) {
            event.target.playVideo();
          }

          function playVideo() {
            player.playVideo();
          }

          function pauseVideo() {
            player.pauseVideo();
          }

          function stopVideo() {
            player.stopVideo();
          }
          
          var mute = false;
          var muteButton = $('#mute-button');
          function muteVideo() {
            if(!mute) {
              player.mute();
              mute = true;
            } else {
              player.unMute();
              mute = false;
            }
          }

          var run = true;
          function onPlayerStateChange(event) {
            console.log(event.data);
            if (event.data == YT.PlayerState.PLAYING && run) {
              var time = player.getCurrentTime();
              console.log(time);
              run = false;
            }
          }
        </script>
      </div>
      <div id="player-controls">

        <div id="progress-bar">
          <div id="line"></div>
          <div id="circle"></div>
        </div>

        <button type="button" class="btn btn-default" aria-lable="Left Align" onclick="playVideo()">
          <span class="glyphicon glyphicon-play control-icon-size" aria-hidden="true"></span>
        </button>

        <button type="button" class="btn btn-default" aria-lable="Left Align" onclick="pauseVideo()">
          <span class="glyphicon glyphicon-pause control-icon-size" aria-hidden="true"></span>
        </button>

        <button type="button" class="btn btn-default" aria-lable="Left Align" onclick="stopVideo()">
          <span class="glyphicon glyphicon-stop control-icon-size" aria-hidden="true"></span>
        </button>

        <button type="button" class="btn btn-default" aria-lable="Left Align" onclick="muteVideo()">
          <span id="mute-button" 
            class="glyphicon glyphicon glyphicon-volume-off control-icon-size"
            aria-hidden="true"
          ></span>
        </button>
    </div>

    <!-- /.container -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>
      window.jQuery ||
        document.write('<script src="js/jquery.min.js"><\/script>');
    </script>
    <script src="js/bootstrap.min.js"></script>
  </body>
</html>
